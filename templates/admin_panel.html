<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - Restaurant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <script>
        function toggleFilterInputs() {
            const filterType = document.getElementById('filter_type').value;
            document.getElementById('filter_date').style.display = filterType === 'date' ? 'block' : 'none';
            document.getElementById('filter_month').style.display = filterType === 'month' ? 'block' : 'none';
            document.getElementById('filter_year').style.display = filterType === 'year' ? 'block' : 'none';
            document.getElementById('filter_range').style.display = filterType === 'range' ? 'block' : 'none';
        }
    </script>
</head>
<body>
    <h2>Admin Panel</h2>
    <a href="{{ url_for('add_item') }}">Add Menu Item</a> |
    <a href="{{ url_for('logout') }}">Logout</a>

    <h3>Filter Sales</h3>
    <form method="POST" action="{{ url_for('admin_panel') }}">
        <label for="filter_type">Filter By:</label>
        <select id="filter_type" name="filter_type" onchange="toggleFilterInputs()">
            <option value="" {% if not filter_type %}selected{% endif %}>--Select--</option>
            <option value="date" {% if filter_type == 'date' %}selected{% endif %}>Specific Date</option>
            <option value="month" {% if filter_type == 'month' %}selected{% endif %}>Specific Month</option>
            <option value="year" {% if filter_type == 'year' %}selected{% endif %}>Specific Year</option>
            <option value="range" {% if filter_type == 'range' %}selected{% endif %}>Date Range</option>
        </select>



        <div id="filter_date" style="display:none;">
            <label for="specific_date">Select Date:</label>
            <input type="date" id="specific_date" name="specific_date">
        </div>

        <div id="filter_month" style="display:none;">
            <label for="month">Select Month:</label>
            <select id="month" name="month">
                {% for m in range(1, 13) %}
                    <option value="{{ m }}">{{ m }}</option>
                {% endfor %}
            </select>
            <label for="year_month">Select Year:</label>
            <select id="year_month" name="year">
                {% for y in range(current_year, current_year - 6, -1) %}
                    <option value="{{ y }}" {% if filter_type == 'month' and y|string == request_form.get('year') %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>

        </div>

        <div id="filter_year" style="display:none;">
            <label for="year_only">Select Year:</label>
            <select id="year_only" name="year_only">
                {% for y in range(current_year, current_year - 6, -1) %}
                    <option value="{{ y }}" {% if filter_type == 'year' and y|string == request_form.get('year') %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>


        </div>

        <div id="filter_range" style="display:none;">
            <label for="start_date">Start Date:</label>
            <input type="date" id="start_date" name="start_date">
            <label for="end_date">End Date:</label>
            <input type="date" id="end_date" name="end_date">
        </div>

        <button type="submit">Apply Filter</button>
    </form>

    <h3>Sales Summary</h3>
    {% if filter_heading %}
        <h4>{{ filter_heading }}</h4>
        <p><strong>Total Sales:</strong> ${{ total_filtered }}</p>
    {% endif %}

    <h3>Orders List</h3>
    {% if orders %}
    <table border="1" cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>User ID</th>
                <th>Table ID</th>
                <th>Total Amount</th>
                <th>Payment Method</th>
                <th>Status</th>
                <th>Created At</th>
                <th>Items</th>
                <th>Status Update</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order[0] }}</td>
                <td>{{ order[1] }}</td>
                <td>{{ order[2] }}</td>
                <td>${{ order[3] }}</td>
                <td>{{ order[4] }}</td>
                <td>{{ order[5] }}</td>
                <td>{{ order[6] }}</td>
                <td>
                    <ul>
                        {% for item in order_details[order[0]] %}
                        <li>{{ item[0] }} x{{ item[1] }} (${{ item[2] }})</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>
                    {% if order[5] != 'Finished' %}
                        <a href="/complete_order/{{ order[0] }}" class="btn btn-success">Mark Finished</a>
                    {% else %}
                        <span class="badge">Finished</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No orders found.</p>
    {% endif %}

    <h3>Menu Items</h3>
    {% if menu_items %}
    <table border="1" cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>Menu ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in menu_items %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
                <td>{{ item[2] }}</td>
                <td>${{ item[3] }}</td>
                <td>
                    <img src="{{ url_for('static', filename=item[4]) }}" alt="{{ item[1] }}" width="100">
                </td>
                <td>
                    <a href="/delete_item/{{ item[0] }}" class="btn btn-danger" onclick="return confirm('Are you sure?')">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No menu items found.</p>
    {% endif %}

    <script>
        window.onload = function() {
            toggleFilterInputs();
        };
    </script>

</body>
</html>
